{% extends 'layout.html' %}

{% load tz %}
{% load humanize %}
{% load bbcode_tags %}

{% block content %}
<script type="text/javascript" src="/scripts/cookies.js"></script>

<script type="text/javascript">
function toggle_elt(uid) {

	var d = new Date();
	d = new Date(d.getFullYear() + 1, d.getMonth(), d.getDay());

	var obj = $(uid);
	if (obj != undefined) {
		if(obj.className == "") {
			obj.className = "hidden";
			SetCookie('display_' + uid, 0, d);
		} else {
			obj.className = "";
			SetCookie('display_' + uid, 1, d);
		}
	}
}

function restore_elt(uid) {

	var obj = $(uid);
	if (obj == undefined) return;

	if (GetCookie('display_' + uid) != 0) $(uid).className = "";
	else $(uid).className = "hidden";
}

function sig(signature) {
    
	if (signature > 0) document.write('(' + formatnumber(signature) + ')');
	else document.write('(indéterminé)');
}
</script>

{% if alliance %}
<div id="motd">
    <table class="default" width="100%">
        <tr class="category">
            <td onclick="toggle_elt('motd_content')">
                Annonce de l'alliance - 
                {% if alliance.defcon == 5 %}<b>DEFCON 5</b> : Préparation normale en temps de paix
                {% elif alliance.defcon == 4 %}<b>DEFCON 4</b> : Préparation normale, mais renseignement accru et mesures de sécurité renforcées
                {% elif alliance.defcon == 3 %}<b>DEFCON 3</b> : Accroissement de la préparation des forces au-dessus de la préparation normale
                {% elif alliance.defcon == 2 %}<b>DEFCON 2</b> : Accroissement supplémentaire dans la préparation des forces
                {% elif alliance.defcon == 1 %}<b>DEFCON 1</b> : Préparation maximale des forces (état de guerre)
                {% endif %}
            </td>
        </tr>
        <tr id="motd_content" class="item">
            <td>
            	{{alliance.motd|bbcode}}
            </td>
        </tr>
    </table>
</div>
{% endif %}

<div id="stats">
    <table class="default" width="100%">
        <tr class="category">
            <td onclick="toggle_elt('stats_content')">
                Statistiques de votre empire - {{empire.date}}
            </td>
        </tr>
        <tr id="stats_content" class="item" valign="top">
            <td>
            	<table class="clear" width="100%">
                	<tr>
                	    <td nowrap>
                        	<div><span class="label">Nation: </span><span class="value">{% if empire.orientation == 1 %}Marchand{% elif empire.orientation == 2 %}Militaire{% elif empire.orientation == 3 %}Scientifique{% endif %} {{empire.name}}</span></div>
                        	<div><span class="label">Grade: </span><span class="value">{% if alliance %}{{empire.rank_label}} de <a href="/game/alliance/?tag={{alliance.tag}}">[{{alliance.tag}}] {{alliance.name}}</a>{% else %}Indépendant{% endif %}</span></div>
                        	<div><span class="label">Trésorerie: </span><span class="value"><img src="{{PATH_IMAGES}}/interface/credits.gif" title="Crédits" class="res" width=16 height=16>{{empire.credits|intcomma}}</span></div>
                        	<div><span class="label">Score de développement: </span><span class="value">{{empire.score_dev|intcomma}}&nbsp;<span class="{% if empire.score_dev_delta > 0 %}plus{% else %}minus{% endif %}">{% if empire.score_dev_delta %}+{% endif %}{{empire.score_dev_delta|intcomma}}</span> (<a href="/game/ranking-players/">rang: {{empire.score_dev_rank}}/{{empire.players}}</a>)</div>
                    	</td>
                    	<td>
                        	<div><span class="label">Nombre de colonies: </span><span class="value">{{empire.cur_planets|intcomma}} / {{empire.max_planets|intcomma}}</span></div>
                        	<div><span class="label">Minerai par heure: </span><span class="value">{{empire.prod_ore|intcomma}}</span></div>
                        	<div><span class="label">Hydrocarbure par heure: </span><span class="value">{{empire.prod_hydro|intcomma}}</span></div>
                        	<div><span class="label">Score de prestige: </span><span class="value">{{empire.score_battle|intcomma}} (<a href="/game/ranking-players/?col=4">rang: {{empire.score_battle_rank}}/{{empire.players}}</a>)</span></div>
                    	</td>
                    	<td>
                        	<div><span class="label">Travailleurs: </span><span class="value">{{empire.workers|intcomma}}</span></div>
                        	<div><span class="label">Scientifiques: </span><span class="value">{{empire.scientists|intcomma}}</span></div>
                        	<div><span class="label">Soldats: </span><span class="value">{{empire.soldiers|intcomma}}</span></div>
                        	<div><span class="label">Points de prestige: </span><span class="value">{{empire.prestige_points|intcomma}}</span></div>
                    	</td>
                    </tr>
            	</table>
            </td>
        </tr>
    </table>
</div>

<div id="fleetsmoving">
    <table class="default" width="100%">
        <tr class="category"><td><b>Mouvements en cours</b></td></tr>
        <tr class="item">
        <td>
        	{% for fleet in fleets %}
        	<div>
            	{% if fleet.owned %}Votre flotte {% if fleet.attack %}<img src="{{PATH_IMAGES}}/interface/stance_attack.gif" class="stance" alt="Attaque" width=10 height=10>{% endif %}{% if fleet.defend %}<img src="{{PATH_IMAGES}}/interface/stance_defend.gif" class="stance" alt="Riposte" width=10 height=10>{% endif %}<a href="/game/fleet/?id={{fleet.id}}" class="self">{{fleet.name}}</a>{% endif %}
            	{% if fleet.ally %}Une flotte alliée de <a href="/game/mails/?to={{fleet.name}}" class="ally" title="Envoyer un message à {{fleet.name}}">{{fleet.name}}</a>{% endif %}
            	{% if fleet.friend %}Une flotte amie de <a href="/game/mails/?to={{fleet.name}}" class="friend" title="Envoyer un message à {{fleet.name}}">{{fleet.name}}</a>{% endif %}
            	{% if fleet.hostile %}Une flotte hostile de <a href="/game/nation/?name={{fleet.name}}" class="enemy" title="Envoyer un message à {{fleet.name}}">{{fleet.name}}</a>{% endif %}
            	<script>sig({{fleet.signature}})</script> est en transit{% if fleet.movingfrom %} de <script>putplanet("{{fleet.f_planetid}}","{{fleet.f_planetname}}","{{fleet.f_g}}","{{fleet.f_s}}","{{fleet.f_p}}",{{fleet.f_relation}});</script>{% endif %}{% if fleet.no_from %} d'une planète inconnue{% endif %} vers <script>putplanet("{{fleet.t_planetid}}","{{fleet.t_planetname}}","{{fleet.t_g}}","{{fleet.t_s}}","{{fleet.t_p}}",{{fleet.t_relation}});</script> - (<script>putcountdown1({{fleet.time}}, "Terminé", "/game/overview/");</script>)
        	</div>
        	{% empty %}
        	<div>Aucun mouvement en cours</div>
        	{% endfor %}
        </td>
        </tr>
    </table>
</div>

<div id="researchesunderway">
    <table class="default" width="100%">
        <tr class="category"><td>Recherche en cours</td></tr>
        <tr class="item">
            <td>
            	{% if research %}<div><a href="/game/research/#{{research.id}}">{{research.label}}</a> (<script>putcountdown1({{research.time}}, "Terminé", "/game/research/");</script>)</div>
            	{% else %}<div><a href="/game/research/" title="Voir le laboratoire de recherches">Aucune recherche en cours</a></div>{% endif %}
            </td>
        </tr>
    </table>
</div>

<div id="buildingsunderconstruction">
    <table class="default" width="100%">
        <tr class="category"><td>Bâtiments en construction</td><td>Vaisseaux en construction</td></tr>
        <tr class="item" valign="top">
            <td width="50%">
            	{% for item in constructionyards %}
            		<table class="clear" cellpadding="0" cellspacing="0">
            		<tr valign="top"><td><a href="/game/buildings/?planet={{item.id}}">{{item.name}} ({{item.g}}.{{item.s}}.{{item.p}}) : </a></td><td>
            			{% for building in item.buildings %}
            			<div>{% if building.destroy %}<span class="destroy">Destruction de {% endif %}{{building.label}} (<script>putcountdown1({{building.time}}, "Terminé", "/game/buildings/?planet={{item.id}}#{{building.id}}");</script>){% if building.destroy %}</span>{% endif %}</div>
            			{% empty %}
            			<div><a href="/game/buildings/?planet={{item.planetid}}" title="Voir les infrastructures">Aucune construction en cours</a></div>
            			{% endfor %}
            		</td></tr>
            		</table>
            	{% endfor %}
            	&nbsp;
            </td>
            <td width="50%">
            	{% for planet in shipyards %}
            		<table class="clear" cellpadding="0" cellspacing="0">
            		<tr valign="top"><td><a href="/game/shipyard/?planet={{planet.planetid}}">{{planet.planetname}} ({{planet.galaxy}}.{{planet.sector}}.{{planet.planet}}) : </a></td><td>
            			{% if planet.ship %}
            			<div>{% if planet.recycle %}Recyclage de {% endif %}{{planet.shiplabel}} (<script>putcountdown1({{planet.time}}, "Terminé", "/game/shipyard/?planet={{planet.planetid}}&f=0#{{planet.shipid}}");</script>)</div>
            			{% endif %}
            			{% if planet.suspended %}
            			<div><a href="/game/shipyard/?planet={{planet.planetid}}" title="Voir le chantier spatial">En pause</a></div>
            			{% endif %}
            			{% if planet.waiting_resources %}
            			<div>{{planet.waiting_ship}} (<span class="error">en attente de ressources</span>)</a></div>
            			{% endif %}
            			{% if planet.none %}
            			<div><a href="/game/shipyard/?planet={{planet.planetid}}" title="Voir le chantier spatial">Aucune construction en cours</a></div>
            			{% endif %}
            		</td></tr>
            		</table>
            	{% endfor %}
            	&nbsp;
            </td>
        </tr>
    </table>
</div>

{% if alliance %}
<script type="text/javascript">
	restore_elt('motd_content');
	restore_elt('stats_content');
	restore_elt('tcg_content');
</script>
{% endif %}
{% endblock %}