{% extends 'layout.html' %}
{% load humanize %}
{% block content %}
{% if members %}
<script>
{% if recruit %}
function showKick(name)
{
	$("kick"+name).style.display = "none";
	$("kickConfirm"+name).style.display = "block";
	$("kickConfirm"+name).style.visibility = "visible";
	return false;
}
{% endif %}

var ranks = new Array();
{% if rank %}
ranks[{{rank_id}}] = {{rank_label:quotehtml}};
{% endfor %}

function showSubmit(){{ $("SubmitChanges").className = "item"; }}

function displayStatus(id,rank,manage,kick){
	var s = '';

	if(!manage)
		s = ranks[rank];
	else
	{
		s = '<select name="player'+id+'" onchange="showSubmit()">';
		for(var x in ranks){
			s += '<option value="'+x+'"'+(rank==x?' selected':'')+'>'+ranks[x]+'</option>';
		}
		s += '</select>';
	}

	document.write(s);
}
</script>
{% endif %}

<table width="850" cellpadding="0" cellspacing="0">
<tr>
<td align=center>
	{% if nav %}
	<div>
	<ul class="htabs">
		{% if cat1 %}<li{% if selected %} class="active"{% endif %}><a href="?cat=1">Membres</a></li>{% endif %}
		{% if cat2 %}<li{% if selected %} class="active"{% endif %}><a href="?cat=2">Invitations</a></li>{% endif %}
	</ul>
	</div>
	{% endif %}
	<div>

{% if members %}

<form action="?cat={{cat}}" method="post">{% csrf_token %}
<table class="default" width="100%">
<tr class="title"><td colspan="7">Nations ralliées</td></tr>
<tr class="header">
<td><a href="?cat={{cat}}&col=1{% if r1 %}&r=1{% endif %}">Nation</a></td>
<td><a href="?cat={{cat}}&col=2{% if r2 %}&r=2{% endif %}">Développement</a></td>
<td><a href="?cat={{cat}}&col=3{% if r3 %}&r=3{% endif %}">Colonies</a></td>
<td><a href="?cat={{cat}}&col=4{% if r4 %}&r=4{% endif %}">Crédits</a></td>
<td><a href="?cat={{cat}}&col=5{% if r5 %}&r=5{% endif %}">Dernière activité</a></td>
<td><a href="?cat={{cat}}&col=6{% if r6 %}&r=6{% endif %}">Date de ralliement</a></td>
<td><a href="?cat={{cat}}&col=7{% if r7 %}&r=7{% endif %}">Statut</a></td>
</tr>

{% if player %}
<tr><td>{{place}}. <a href="/game/nation/?name={{name}}" title="Afficher les infos sur {{name}}">{{name}}</a><br/><span class="grey">{% if orientation1 %}Marchand{% endif %}{% if orientation2 %}Militaire{% endif %}{% if orientation3 %}Scientifique{% endif %}{% if orientation4 %}Seigneur de guerre{% endif %}</span></td>
<td align="right">
{% if score %}{{score|intcomma}}<br/><span{% if plus %} class="plus"{% endif %}{% if minus %} class="minus"{% endif %}>{% if plus %}+{% endif %}{{score_delta|intcomma}}</span>{% endif %}
{% if score_na %}<span class="grey">Non publié</span>{% endif %}
</td>
<td align="right">{{stat_colonies}}</td>
<td align="right"><img src="{{PATH_IMAGES}}/interface/credits.gif" title="Crédits" class="res" width="16" height="16">{% if lowcredits %}<span class="low">{% endif %}{{credits|intcomma}}{% if lowcredits %}</span>{% endif %}</td>
<td align="right">
{% if banned %}<span class="banned">Compte suspendu</span>{% endif %}
{% if onholidays %}<span class="onholidays">En vacances</span>{% endif %}
{% if online %}<span class="recent">En ligne</span>{% endif %}
{% if less1h %}<span class="recent">&lt; 1 heure</span>{% endif %}
{% if hours %}<span class="recent">{{hours}} heure(s)</span>{% endif %}
{% if days %}<span class="fewdays">{{days}} jour(s)</span>{% endif %}
{% if 1weekplus %}<span class="fewweeks">&gt;1 semaine</span>{% endif %}
{% if 2weeksplus %}<span class="fewweeks">&gt;2 semaines</span>{% endif %}
</td>
<td>{{joined}}</td>
<td id="statusref{{id}}">
<script>displayStatus({{id}},{{rank}},0{% if manage %}1{% endmanage %},0{% if kick %}1{% endif %});</script>
{% if kick %} - <span id="kick{{id}}" onclick="return showKick({{id}});"><a href="?#">Exclure</a></span><span id="kickConfirm{{id}}" class="hidden">Coût: <img src="{{PATH_IMAGES}}/interface/credits.gif" title="Crédits" class="res" width="16" height="16">{{kick_price|intcomma}}&nbsp;<a href="?cat={{cat}}&a=kick&name={{name}}">Confirmer</a></span>{% endif %}
{% if leaving %}&nbsp;<span class="warning">Quitte: <script>putcountdown1({{leaving_time}}, "Terminé", "?cat={{cat}}");</script></span>{% endif %}
</td>
</tr>
{% endfor %}

<tr>
<td class="justhidden"></td>
<td align="right">{% if score %}{{total_score|intcomma}}<br/><span{% if plus %} class="plus"{% endif %}{% if minus %} class="minus"{% endif %}>{% if plus %}+{% endif %}{{total_score_delta|intcomma}}</span>{% endif %}
{% if score_na %}<span class="grey">Non publié</span>{% endif %}
</td>
<td align="right">{{total_colonies|intcomma}}</td>
<td align="right"><img src="{{PATH_IMAGES}}/interface/credits.gif" title="Crédits" class="res" width="16" height="16">{{total_credits|intcomma}}</td>
<td colspan="3" class="justhidden"></td>
</tr>

<tr id="SubmitChanges" class="hidden"><td colspan="6" align="center"><input type="submit" name="submit" value="Valider changements"></td></tr>
</table>
</form>
{% endif %}

{% if invitations %}
<form action="?cat={{cat}}" method="post">{% csrf_token %}
<table class="default" width="100%">
<tr class=title><td>Inviter une nation à rallier notre alliance</td></tr>
<tr class=item align=center><td>Nation <input type="text" name="name" value="{{player}}"><br/><br/>
<input type="submit" name="submit" value="Rallier"></td></tr>
{% if message %}<tr><td class="error">
{% if ok %}Nation invitée{% endif %}
{% if norights %}Vous n'êtes pas en droit de rallier de nouvelles nations{% endif %}
{% if unknown %}Aucune nation répondant à ce nom n'a été trouvée{% endif %}
{% if already_member %}Cette nation est déjà membre de notre alliance !{% endif %}
{% if already_invited %}Cette nation a déjà été invitée récemment{% endif %}
{% if impossible %}Cette nation ne peut être invitée{% endif %}
</td></tr>
{% endif %}
</table>
</form>

<br/>

<table class="default" width="100%">
<tr class="title"><td colspan=4>Invitations de ralliement en cours...</td></tr>
<tr class="header"><td>Nation</td><td>Date d'invitation</td><td>Invité par</td><td>Réponse</td></tr>

{% if invitation %}
<tr class="smallitem"><td>{{name}}</td><td>{{date}}</td><td>{{recruiter}}&nbsp;</td><td>{% if waiting %}En attente{% endif %}{% if declined %}Refusée{% endif %}</td></tr>
{% endfor %}

{% if noinvitations %}
<tr><td colspan=4 align=center>Aucune invitation</td></tr>
{% endif %}

</table>
{% endif %}

	</div>

</td>
</tr>
</table>
{% endblock %}