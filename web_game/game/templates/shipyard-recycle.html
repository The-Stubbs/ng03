{% extends 'layout.html' %}

{% load humanize %}

{% block content %}
{% include '_tabs_planet.html' %}
<script>
var ships=new Array();
var shiplist=new Array();

{% for category in categories %}{% for ship in category.ships %}
{% if ship.build %}shiplist.push({{ship.id}});{% endif %}
ships[{{ship.id}}]=new Array('{{ship.description|escapejs}}','{{ship.ship_signature|intcomma}}','{{ship.ship_cargo|intcomma}}','{{ship.ship_speed|intcomma}}','{{ship.ship_handling|intcomma}}',{{ship.ship_turrets}},{{ship.ship_power}},'{{ship.ship_tracking_speed|intcomma}}','{{ship.ship_hull|intcomma}}','{{ship.ship_shield|intcomma}}','{{ship.ship_recycler_output|intcomma}}','{{ship.ship_long_distance_capacity|intcomma}}','{{ship.ship_droppods|intcomma}}',{{ship.ore}},{{ship.hydrocarbon}},{{ship.credits}},{{ship.crew}},{{ship.time}});{% endfor %}{% endfor %}

function descShip(id) {
	var ship = ships[id];
	var a = '<table><div valign="top"><div class="col"> <span class="title">Description</span><br/><br/>'+ship[0]+'</div"><div width="1%" nowrap><span class="title">Caractéristiques</span><br/>'+
			'<br/>Signature: <span class=value>'+ship[1]+'</span><br/>Cargo: <span class=value>'+ship[2]+'</span>'+
			'<br/>Vitesse: <span class=value>'+ship[3]+'</span><br/>Manœuvrabilité: <span class=value>'+ship[4]+'</span>';
	if(ship[6] > 0)
		a+= '<br/>Puissance d\'attaque: <span class=value>'+ship[5]+'x'+ship[6]+'</span><br/>Ciblage: <span class=value>'+ship[7]+'</span>';
	a+= '<br/>Armure: <span class=value>'+ship[8]+'</span>';
	if(ship[9] != '0')	a+= '<br/>Bouclier: <span class=value>'+ship[9]+'</span>';
	if(ship[10] != '0') a+= '<br/>Capacité de recyclage: <span class=value>'+ship[10]+'</span>';
	if(ship[11] != '0') a+= '<br/>Capacité de saut intergalactique: <span class=value>'+ship[11]+'</span>';
	if(ship[12] != '0') a+= '<br/>Capacité d\'invasion: <span class=value>'+ship[12]+'</span>';
	a+= '</div></div></div>';
	return a;
}


function updateNeeds() {
	var ore=0;
	var hydrocarbon=0;
	var totaltime=0;

	var i,id,c;

	for(i=0;i<shiplist.length;i++){
		id = shiplist[i];
		c = getval('s'+id);

		ore += c * ships[id][13];
		hydrocarbon += c * ships[id][14];
		totaltime += c * ships[id][17];
	}

	$("totalore").innerHTML = formatnumber(ore);
	$("totalhydrocarbon").innerHTML = formatnumber(hydrocarbon);
	$("totaltime").innerHTML = formattime(totaltime);
}
</script>
<script type="text/javascript" src='/scripts/third-party/tooltip.js?v=1'></script>
<script>
tipname = "hint";
tipwidth = 450;
tiptext = $("hinttext");
</script>

<div id="shipyard">
<form method="post" action="?f={{filter}}&planet={{planetid}}&a=recycle">
{% csrf_token %}
<div class="box">
<div class="box-body header"><div class="col"> Vaisseau</div"><div width=100>Minerai</div"><div width=100>Hydrocarbure</div"><div width=90>Temps</div"><div width='1%'>Construction</div></div>

{% if no_shipyard %}
<div><div colspan=5><p class="error">Aucun vaisseau n'est recyclable.</p></div></div>
{% endif %}

{% for category in categories %}
<div class="box-body category">
	<div colspan=5>
	{% if category.id == 10 %}Vaisseaux utilitaires{% endif %}
	{% if category.id == 11 %}Vaisseaux de déploiement{% endif %}
	{% if category.id == 15 %}Vaisseaux tactiques{% endif %}
	{% if category.id == 20 %}Vaisseaux légers{% endif %}
	{% if category.id == 30 %}Corvettes{% endif %}
	{% if category.id == 40 %}Frégates{% endif %}
	{% if category.id == 50 %}Croiseurs{% endif %}
	{% if category.id == 60 %}Dreadnought{% endif %}
	{% if category.id == 80 %}Titan{% endif %}
	{% if category.id == 90 %}Plateforme de défense{% endif %}
	&nbsp;
	</div>
</div>

{% for ship in category.ships %}
<div valign=middle align=right class="item">

<div nowrap align=left>
	<div class=clear width="100%">
	<div><div class="col"> <a href="help.asp?cat=ships#{{ship.id}}" onmouseover="ddrivetip(descShip({{ship.id}}))" onmouseout="hideddrivetip()"><b>{{ship.name}}</b></a></div"><div align=right>x{{ship.quantity}}</div></div>
	</div>
</div>
<div nowrap><img src="{{PATH_IMAGES}}/interface/ore.gif" class="icon" title="Minerai" width=16 height=16> {{ship.ore|intcomma}}</div>
<div nowrap><img src="{{PATH_IMAGES}}/interface/hydrocarbon.gif" class="icon" title="Hydrocarbure" width=16 height=16> {{ship.hydrocarbon|intcomma}}</div>
<div align=center>
{% if ship.construction_time %}<script>document.write(formattime({{ship.time}}));</script>{% endif %}
{% if ship.no_construction_time %}-{% endif %}
</div>

<div align=center style="padding:0;margin:0">
	{% if ship.build %}<input type="text" name="s{{ship.id}}" onkeyup="updateNeeds()" size=3 maxlength=4 style="height:18px">{% endif %}
	{% if ship.cant_build %}&nbsp;{% endif %}
</div>

</div>
{% endfor %}
{% endfor %}

{% if build %}<div>
<div class=justhidden>&nbsp;</div>
<div align=right><img src="{{PATH_IMAGES}}/interface/ore.gif" class="icon" title="Minerai" width=16 height=16><span id=totalore>0</span></div>
<div align=right><img src="{{PATH_IMAGES}}/interface/hydrocarbon.gif" class="icon" title="Hydrocarbure" width=16 height=16><span id=totalhydrocarbon>0</span></div>
<div align=center><span id=totaltime><script>document.write(formattime(0));</script></span></div>
<div align=center><input type="submit" value="Recycler"></div></div>{% endif %}

{% if underconstructions|length > 0 %}
<div class="box-body clear"><div colspan="7">&nbsp;</div></div>
<div class="box-body category">
	<div colspan="7">En cours</div>
</div>
	{% for ship in underconstructions %}
	<div align="right">
		<div align="left" nowrap colspan="1">
			<div class="clear" width="100%">
			<div><div class="col"> {% if ship.recycle %}Recyclage de {% endif %}<a href="help.asp?cat=ships#{{ship.id}}"><b>{{ship.name}}</b></a></div"><div align="right">x{{ship.quantity}}</div></div>
			{% if ship.required_ship %}<div><div colspan=2 nowrap><p class="shiprequirement">Requiert {{ship.required_ship_name}}</p></div></div>{% endif %}
			{% if ship.required_victory_marks %}<div><div colspan="2" nowrap><p class="shiprequirement">Requiert {{ship.required_victory_marks}} points de combat</p></div></div>{% endif %}
			</div>
		</div>
		<div nowrap><img src="{{PATH_IMAGES}}/interface/ore.gif" class=icon title="Minerai" width=16 height=16>{{ship.ore|intcomma}}</div>
		<div nowrap><img src="{{PATH_IMAGES}}/interface/hydrocarbon.gif" class=icon title="Hydrocarbure" width=16 height=16>{{ship.hydrocarbon|intcomma}}</div>
		<div align="center"><script>putcountdown1({{ship.remainingtime}},"&nbsp;");</script></div>
		<div align="center"><script>putcountdown2({{ship.remainingtime}}, "{% if ship.recycle %}&nbsp;{% endif %}{% if ship.cancel %}<a href='?f={{filter}}&planet={{planetid}}&a=cancel&q={{ship.queueid}}'>annuler</a>{% endif %}", "<a href='shipyard.asp?planet={{planetid}}&f={{filter}}'>terminé</a>");</script></div>
	</div>
	{% endfor %}
{% endif %}
{% if queues|length > 0 %}
<div class="box-body clear"><div colspan="7">&nbsp;</div></div>
<div class="box-body category">
	<div colspan="7">En queue</div>
</div>
	{% for ship in queues %}
	<div align="right">
		<div align="left" colspan="1">
			<div class="clear" width="100%">
			<div><div class="col"> {% if ship.recycle %}Recyclage de {% endif %}<a href="help.asp?cat=ships#{{ship.id}}"><b>{{ship.name}}</b></a></div"><div align="right">x{{ship.quantity}}</div></div>
			{% if ship.required_ship %}<div><div colspan=2 nowrap><p class="shiprequirement">Requiert {{ship.required_ship_name}}</p></div></div>{% endif %}
			{% if ship.required_victory_marks %}<div><div colspan="2" nowrap><p class="shiprequirement">Requiert {{ship.required_victory_marks}} points de combat</p></div></div>{% endif %}
			</div>
		</div>
		<div nowrap><img src="{{PATH_IMAGES}}/interface/ore.gif" class=icon title="Minerai" width=16 height=16>{{ship.ore|intcomma}}</div>
		<div nowrap><img src="{{PATH_IMAGES}}/interface/hydrocarbon.gif" class=icon title="Hydrocarbure" width=16 height=16>{{ship.hydrocarbon|intcomma}}</div>
		<div align="center"><script language="javascript">document.write(formattime({{ship.remainingtime}}));</script></div>
		<div align="center"><a href="?f={{filter}}&planet={{planetid}}&a=cancel&q={{ship.queueid}}">annuler</a></div>
	</div>
	{% endfor %}
{% endif %}
</div>
</form>
</div>
{% endblock %}