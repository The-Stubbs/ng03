{% extends 'layout.html' %}
{% load humanize %}
{% block content %}
<script>
function confirmBreakPact(tag,name) {
	var s = "Êtes-vous sûr de vouloir rompre le pacte avec ["+tag+"] "+name+" ?";
	return confirm(s);
}
</script>

<table width=750 cellpadding=0 cellspacing=0>
<tr>
<td align="center">
	{% if nav %}
	<div>
	<ul class="htabs">
		{% if cat1 %}<li{% if selected %} class="active"{% endif %}><a href="?cat=1">Pactes signés</a></li>{% endcat1 %}
		{% if cat2 %}<li{% if selected %} class="active"{% endif %}><a href="?cat=2">Propositions{% if propositions %} ({{propositions}}){% endpropositions %}</a></li>{% endcat2 %}
		{% if cat3 %}<li{% if selected %} class="active"{% endif %}><a href="?cat=3">Demandes de pactes{% if requests %} ({{requests}}){% endrequests %}</a></li>{% endcat3 %}
	</ul>
	</div>
	{% endif %}
	<div>

{% if naps %}
<table class="default" width="100%">
<tr class="title"><td colspan="5">Pacte(s) de non-agression</td></tr>
<tr class="header">
<td><a href="?col=1{% if r1 %}&r=1{% endif %}">Alliance</a></td>
{% if score %}<td><a href="?col=2{% if r2 %}&r=1{% endif %}">Score</a></td>{% endif %}
<td><a href="?col=3{% if r3 %}&r=1{% endif %}">Date de l'accord</a></td>
<td><a href="?col=4{% if r4 %}&r=1{% endif %}">Délai d'éxecution</a></td>
<td><a href="?col=5{% if r5 %}&r=1{% endif %}">Vision planètes</a></td>
<td><a href="?col=6{% if r6 %}&r=1{% endif %}">Partage radars</a></td>
{% if break %}<td>Pacte</td>{% endif %}
</tr>
{% if nap %}
<tr><td>{{place}}. <a href="/game/alliance/?tag={{tag}}">[{{tag}}] {{name}}</a></td>
{% if score %}<td align=right>{{score|intcomma}}</td>{% endif %}
<td>{{created}}</td>
<td align=right><script>
{% if countdown %}putcountdown1({{break_interval}}, "Rompu", "?"){% endif %}
{% if time %}document.write(formattime({{break_interval}})){% endif %}
</script></td>
<td>
{% if toggle_share_locs %}<a href="?cat={{cat}}&a=sharelocs&tag={{tag}}">{% endif %}{% if locs_shared %}Oui{% endlocs_shared %}{% if locs_not_shared %}Non{% endif %}{% if toggle_share_locs %}</a>{% endif %}
</td>
<td>
{% if toggle_share_radars %}<a href="?cat={{cat}}&a=shareradars&tag={{tag}}">{% endif %}{% if radars_shared %}Oui{% endradars_shared %}{% if radars_not_shared %}Non{% endif %}{% if toggle_share_radars %}</a>{% endif %}
</td>
{% if break %}<td><a href="?cat={{cat}}&a=break&tag={{tag}}" onclick="return confirmBreakPact('{{tag}}','{{name}}')">Rompre</a></td>{% endif %}
{% if broken %}<td>Rompu</td>{% endif %}
</tr>
{% endfor %}
{% if nonaps %}
<tr><td colspan=6 align=center>Aucun</td></tr>
{% endif %}
{% if message %}<tr><td colspan=5 class="error">
{% if norights %}Vous n'êtes pas en droit de faire une telle demande{% endnorights %}
{% if unknown %}Aucune alliance avec un tel tag n'a été trouvé{% endunknown %}
{% if nap_not_found %}Nous n'avons aucun pacte avec cette alliance{% endnap_not_found %}
{% if not_enough_credits %}L'alliance ne dispose pas d'assez de crédits pour rompre le pacte{% endnot_enough_credits %}
</td></tr>
{% endif %}
</table>
{% endnaps %}

{% if propositions %}
<table class="default" width="100%">
<tr class="title"><td colspan="6">Propositions de pactes de non-agression</td></tr>
<tr class="header">
<td>Alliance</td><td>Date de demande</td><td>Demandé par</td><td>Délai d'exécution</td><td>Réponse</td>
{% if proposition %}
<tr class="smallitem"><td nowrap><a href="/game/alliance/?tag={{tag}}">[{{tag}}] {{name}}</a></td>
<td nowrap>{{date}}</td><td><a href="/game/mails/?to={{recruiter}}" title="Envoyer un message à {{recruiter}}">{{recruiter}}</a>&nbsp;</td>
<td nowrap><script>document.write(formattime({{break_interval}}))</script></td>
<td nowrap><a href="?cat={{cat}}&a=accept&tag={{tag}}">Accepter</a> - <a href="?cat={{cat}}&a=decline&tag={{tag}}">Refuser</a></td></tr>
{% endfor %}
{% if nopropositions %}
<tr><td colspan=6 align=center>Aucune proposition</td></tr>
{% endnopropositions %}
</td>
{% if message %}<tr><td colspan=2 class="error">
{% if ok %}PNA créé{% endok %}
{% if too_many %}Trop de PNA sont déjà en cours par une des alliances concernées{% endtoo_many %}
</td></tr>
{% endif %}
</table>
{% endpropositions %}

{% if newnaps %}
<form action="?cat={{cat}}&a=new" method="post">{% csrf_token %}
<table class="default">
<tr class="title"><td colspan=2>Établir un pacte de non-agression</td></tr>
<tr><td colspan=2>Veuillez indiquer le tag de l'alliance avec laquelle créer un PNA.<br/>
Vous pouvez spécifier un délai d'exécution lorsqu'une alliance décidera de rompre le pacte. Maximum 72 heures : 3 jours.</td></tr>
<tr><td>Alliance (tag)</td><td><input type="text" name="tag" value="{{tag}}" maxlength=4></td></tr>
<tr><td>Délai d'exécution</td><td><input type="text" name="hours" value="{{hours}}" maxlength="2"> heures</td></tr>
<tr><td colspan=2 align=center><input type="submit" name="submit" value="Envoyer"></td></tr>
{% if message %}<tr><td colspan=2 class="error">
{% if ok %}Demande envoyée{% endok %}
{% if norights %}Vous n'êtes pas en droit de faire une telle demande{% endnorights %}
{% if unknown %}Aucune alliance avec un tel tag n'a été trouvé{% endunknown %}
{% if already_naped %}Cette alliance a déjà un pacte avec notre alliance !{% endalready_naped %}
{% if request_waiting %}Cette alliance nous a déjà offert un pacte, acceptons leur pacte{% endrequest_waiting %}
{% if already_requested %}Nous avons déjà essayé d'établir un pacte avec cette alliance récemment{% endalready_requested %}
</td></tr>
{% endif %}
</table>
</form>

<br/>

<table class="default" width="100%">
<tr class="title"><td colspan="7">Nos demandes de pacte aux autres alliances</td></tr>
<tr class="header">
<td>Alliance</td><td>Date de demande</td><td>Demandé par</td><td>Délai d'exécution</td><td>Réponse</td><td></td>
{% if request %}
<tr class="smallitem"><td><a href="/game/alliance/?tag={{tag}}">[{{tag}}] {{name}}</a></td>
<td>{{date}}</td>
<td>{{recruiter}}</td>
<td nowrap><script>document.write(formattime({{break_interval}}))</script></td>
<td nowrap>{% if waiting %}En attente{% endwaiting %}{% if declined %}Refusée{% enddeclined %}</td>
<td><a href="?cat={{cat}}&a=cancel&tag={{tag}}">Annuler</a></td>
</tr>
{% endfor %}
{% if norequests %}
<tr><td colspan=6 align=center>Aucune demande</td></tr>
{% endnorequests %}
</td>
</table>
{% endnewnaps %}

</div>

</td>
</tr>
</table>
{% endblock %}